# Домашнее задание к занятию "13.Системы мониторинга"

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя 
платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой 
осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы
выведите в мониторинг и почему?
#
##Ответ:
Для эффективного мониторинга данного проекта рекомендуется вывести следующие метрики:

1. CPU utilization: это важная метрика, которая позволяет отслеживать нагрузку на ЦПУ. Она поможет понять, сколько процессорного времени выделяется на вычисления и насколько загружен процессор в целом.

2. Memory usage: метрика отслеживает использование оперативной памяти приложением, также показывает, сколько памяти свободно для обработки новых запросов.

3. Request rate: число запросов к платформе в единицу времени. В зависимости от масштабов проекта можно выбрать самый оптимальный период времени для усреднения.

4. Response time: метрика показывает сколько времени занимает обработка запросов и формирование ответа, также позволяет обнаруживать узкие места в работе приложения, например, неоптимальный алгоритм вычислений.

5. HTTP status codes: данная метрика позволяет отслеживать количество 4xx и 5xx ошибок, которые возникают при взаимодействии с приложением по протоколу HTTP. Эти коды могут указывать на ошибки в работе приложения, например, при неправильных запросах.

Вышеперечисленный набор метрик поможет проводить мониторинг нагрузки на систему и выявлять проблемы, возникающие в работе приложения. Он обеспечит достаточно информации о состоянии системы для раннего выявления и устранения проблем.

2. Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, 
что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы 
можете ему предложить?
#
##Ответ:
Я могу предложить ему создание отчетов, которые покажут нашу производительность по обслуживанию клиентов, такие как время ответа на заявки, время решения проблем и уровень удовлетворенности клиентов. Также мы можем разместить им скрипты, которые будут автоматически отправлять уведомления о падении производительности на сервере. Мы также можем рассмотреть возможность обучения менеджера продукта на тему технологий, которые используются в интеграции и обслуживании сервера.

3. Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою 
очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, 
чтобы разработчики получали ошибки приложения?
#
##Ответ:
Я могу предложить использование бесплатных инструментов для сбора логов, таких как Graylog, ELK Stack или Fluentd, которые позволяют настроить отправку логов через стандартные протоколы, такие как HTTP или UDP. Это позволит разработчикам видеть все ошибки, которые выдают их приложения в реальном времени. Также мы можем настроить отправку уведомлений на адрес разработчиков в случае возникновения ошибок, что поможет им быстрее реагировать на проблемы. Если нам это позволено, то мы можем спланировать включение построения системы сбора логов в бюджет на следующий год.

4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. 
Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 
70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?
#
##Ответ:
Если приложение не выдает кодов ответа 4xx и 5xx, то на основании формулы SLA=99% по http кодам ответов, можно предположить, что в вычисления попадают только коды ответа 2xx и 3xx. В таком случае, максимальное значение данного параметра будет 100%, так как запросы с любым кодом ответа будут учитываться в summ_all_requests и только коды ответа 2xx будут учитываться в summ_2xx_requests.  
Таким образом, ошибка заключается в том, что формула расчета SLA=99% по http кодам ответов не соответствует требованиям и общепринятому пониманию стандартных кодов HTTP. В данном случае, следует пересмотреть формулу и обновить мониторинг, чтобы была возможность увидеть все коды ответа и правильно рассчитывать SLA.

5. Опишите основные плюсы и минусы pull и push систем мониторинга.
#
##Ответ
Push системы мониторинга:

Плюсы:
- Push системы отправляют данные в реальном времени, что позволяет оперативно реагировать на изменения состояния системы и предотвращать проблемы до их возникновения.
- Push системы обеспечивают полную контрольную точку для анализа изменения состояния объектов мониторинга.
- Push системы позволяют обеспечивать достаточный уровень данных для интеграции с машинной обработкой данных, анализом, репликацией и архивированием информации.

Минусы:
- Push системы требуют настройки клиента для отправки данных, что часто означает много работы по конфигурированию и автоматизации на стороне клиента.
- Отправка данных постоянно приводит к увеличению нагрузки на сеть и хранилище данных, что может повлиять на показатели производительности системы.

Pull системы мониторинга:

Плюсы:
- Pull системы не создают постоянной нагрузки на сети и хранилища данных, потому что отправка данных происходит только при запросе данных.
- Pull системы могут использовать несколько различных механизмов для запроса данных, что позволяет настроить систему мониторинга для каждого объекта мониторинга.

Минусы:
- При использовании Pull систем данных может возникнуть искажение информации, из-за того что данные могут быть временно недоступны в момент запроса.
- Pull системы могут требовать дополнительного времени на анализ получаемых данных.

6. Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

    - Prometheus 
    - TICK
    - Zabbix
    - VictoriaMetrics
    - Nagios
#
##Ответ:

7. Склонируйте себе [репозиторий](https://github.com/influxdata/sandbox/tree/master) и запустите TICK-стэк, 
используя технологии docker и docker-compose.

В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (`http://localhost:8888`). 

P.S.: если при запуске некоторые контейнеры будут падать с ошибкой - проставьте им режим `Z`, например
`./data:/var/lib:Z`
#
8. Перейдите в веб-интерфейс Chronograf (`http://localhost:8888`) и откройте вкладку `Data explorer`.

    - Нажмите на кнопку `Add a query`
    - Изучите вывод интерфейса и выберите БД `telegraf.autogen`
    - В `measurments` выберите mem->host->telegraf_container_id , а в `fields` выберите used_percent. 
    Внизу появится график утилизации оперативной памяти в контейнере telegraf.
    - Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. 
    Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.

Для выполнения задания приведите скриншот с отображением метрик утилизации места на диске 
(disk->host->telegraf_container_id) из веб-интерфейса.
#
9. Изучите список [telegraf inputs](https://github.com/influxdata/telegraf/tree/master/plugins/inputs). 
Добавьте в конфигурацию telegraf следующий плагин - [docker](https://github.com/influxdata/telegraf/tree/master/plugins/inputs/docker):
```
[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
```

Дополнительно вам может потребоваться донастройка контейнера telegraf в `docker-compose.yml` дополнительного volume и 
режима privileged:
```
  telegraf:
    image: telegraf:1.4.0
    privileged: true
    volumes:
      - ./etc/telegraf.conf:/etc/telegraf/telegraf.conf:Z
      - /var/run/docker.sock:/var/run/docker.sock:Z
    links:
      - influxdb
    ports:
      - "8092:8092/udp"
      - "8094:8094"
      - "8125:8125/udp"
```

После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список `measurments` в 
веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.

Факультативно можете изучить какие метрики собирает telegraf после выполнения данного задания.

## Дополнительное задание (со звездочкой*) - необязательно к выполнению

1. Вы устроились на работу в стартап. На данный момент у вас нет возможности развернуть полноценную систему 
мониторинга, и вы решили самостоятельно написать простой python3-скрипт для сбора основных метрик сервера. Вы, как 
опытный системный-администратор, знаете, что системная информация сервера лежит в директории `/proc`. 
Также, вы знаете, что в системе Linux есть  планировщик задач cron, который может запускать задачи по расписанию.

Суммировав все, вы спроектировали приложение, которое:
- является python3 скриптом
- собирает метрики из папки `/proc`
- складывает метрики в файл 'YY-MM-DD-awesome-monitoring.log' в директорию /var/log 
(YY - год, MM - месяц, DD - день)
- каждый сбор метрик складывается в виде json-строки, в виде:
  + timestamp (временная метка, int, unixtimestamp)
  + metric_1 (метрика 1)
  + metric_2 (метрика 2)
  
     ...
     
  + metric_N (метрика N)
  
- сбор метрик происходит каждую 1 минуту по cron-расписанию

Для успешного выполнения задания нужно привести:

а) работающий код python3-скрипта,

б) конфигурацию cron-расписания,

в) пример верно сформированного 'YY-MM-DD-awesome-monitoring.log', имеющий не менее 5 записей,

P.S.: количество собираемых метрик должно быть не менее 4-х.
P.P.S.: по желанию можно себя не ограничивать только сбором метрик из `/proc`.

2. В веб-интерфейсе откройте вкладку `Dashboards`. Попробуйте создать свой dashboard с отображением:

    - утилизации ЦПУ
    - количества использованного RAM
    - утилизации пространства на дисках
    - количество поднятых контейнеров
    - аптайм
    - ...
    - фантазируйте)
    
    ---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---

